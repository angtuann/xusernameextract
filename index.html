<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>X Username Extractor — GitHub Pages</title>
  <style>
    :root {
      --bg: #0b0d10;
      --panel: #131720;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22d3ee;
      --accent-2: #60a5fa;
      --danger: #fb7185;
      --ok: #34d399;
      --warning: #f59e0b;
      --radius: 16px;
      --link: #facc15; /* vàng */
      --link-visited: #ffffff; /* trắng */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 30% -10%, rgba(34,211,238,.15), transparent),
                  radial-gradient(1000px 600px at 80% 10%, rgba(96,165,250,.10), transparent),
                  var(--bg);
      color:var(--text);
    }
    .container{max-width:1100px;margin:40px auto;padding:0 16px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    header h1{font-size: clamp(20px, 3vw, 28px);margin:0}
    header .tag{font-size:12px;color:var(--muted);border:1px solid #263042;padding:2px 8px;border-radius:999px}

    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid #233042;padding:18px;border-radius:var(--radius);box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width: 980px){ .grid{grid-template-columns: 1.2fr .8fr} }

    textarea{
      width:100%;min-height:220px;background:#0e1218;border:1px solid #253042;color:var(--text);
      border-radius:14px;padding:14px;resize:vertical;font-size:14px;line-height:1.45;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      color:#041318; border:0; padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer;
      box-shadow:0 6px 18px rgba(34,211,238,.25);
    }
    .btn.secondary{background:#141a24;color:var(--text);border:1px solid #263042;box-shadow:none}
    .btn.ghost{background:transparent;color:var(--muted);border:1px dashed #334155}

    .hint{font-size:12px;color:var(--muted)}

    table{width:100%;border-collapse:collapse;background:#0e1218;border:1px solid #253042;border-radius:12px;overflow:hidden}
    thead{background:#121826}
    th,td{padding:10px 12px;border-bottom:1px solid #1f2937;font-size:13px}
    tbody tr:hover{background:#111827}

    .table-container{max-height:500px;overflow-y:auto} /* scroll cho bảng */

    .stat{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:13px}
    .pill{border:1px solid #263042;padding:4px 8px;border-radius:999px}
    .ok{color:var(--ok)}
    .warn{color:var(--warning)}
    .dropzone{border:1px dashed #334155;border-radius:14px;padding:12px;text-align:center;color:var(--muted)}

    a{color:var(--link);text-decoration:none}
    a:visited{color:var(--link-visited)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>X Username Extractor</h1>
      <span class="tag">Client-side • GitHub Pages ready</span>
    </header>
    <div class="grid">
      <section class="card">
        <textarea id="input" placeholder="Dán link tại đây"></textarea>
        <div class="row" style="margin-top:10px;align-items:center;justify-content:space-between">
          <div class="row" style="gap:8px">
            <input id="dedupe" type="checkbox" checked /> <label for="dedupe" class="hint">Loại bỏ trùng</label>
            <input id="skipBlank" type="checkbox" checked /> <label for="skipBlank" class="hint">Bỏ trống</label>
            <input id="findUrls" type="checkbox" checked /> <label for="findUrls" class="hint">Tự động lọc URL</label>
          </div>
          <div class="row">
            <button id="btnExtract" class="btn" type="button">Trích xuất</button>
          </div>
        </div>
        <div id="dropzone" class="dropzone" style="margin-top:10px">Kéo & thả file .csv/.txt</div>
      </section>

      <aside class="card">
        <h3 style="margin-top:0">Xuất kết quả</h3>
        <div class="row" style="flex-wrap:wrap">
          <button id="btnCopyUrls" class="btn secondary" type="button">Copy URLs</button>
          <button id="btnCopyUsernames" class="btn secondary" type="button">Copy Usernames</button>
          <button id="btnCopyIds" class="btn secondary" type="button">Copy Tweet IDs</button>
          <button id="btnDownloadTxt" class="btn secondary" type="button">Tải TXT</button>
        </div>
      </aside>
    </div>

    <section class="card" style="margin-top:16px">
      <div class="table-container">
        <table id="table">
          <thead>
            <tr>
              <th>#</th>
              <th>Original URL</th>
              <th>Username</th>
              <th>Tweet ID</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    const input=document.getElementById('input');
    const btnExtract=document.getElementById('btnExtract');
    const tableBody=document.querySelector('#table tbody');
    const btnCopyUrls=document.getElementById('btnCopyUrls');
    const btnCopyUsernames=document.getElementById('btnCopyUsernames');
    const btnCopyIds=document.getElementById('btnCopyIds');
    const btnDownloadTxt=document.getElementById('btnDownloadTxt');
    const dedupe=document.getElementById('dedupe');
    const skipBlank=document.getElementById('skipBlank');
    const findUrlsToggle=document.getElementById('findUrls');

    let results=[];
    const SOURCES=['x.com','twitter.com','mobile.twitter.com','fxtwitter.com','vxtwitter.com','nitter.net'];

    function parseUrl(raw){
      try{
        let s=raw.trim();
        if(!/^https?:\/\//i.test(s)) s='https://'+s;
        const u=new URL(s);
        if(!SOURCES.some(h=>u.hostname.includes(h))) return {original:raw,valid:false};
        const p=u.pathname.split('/').filter(Boolean);
        if(p.length>=3 && p[1]==='status') return {original:raw,username:p[0],tweet_id:p[2],valid:true};
        if(p.length>=2 && p[0]==='status') return {original:raw,username:'',tweet_id:p[1],valid:true};
        return {original:raw,valid:false};
      }catch(e){return {original:raw,valid:false};}
    }

    function extract(text){
      let cands=[];
      const urlRe=/(?:https?:\/\/)?(?:www\.)?(?:x\.com|twitter\.com|mobile\.twitter\.com|fxtwitter\.com|vxtwitter\.com|nitter\.net)\/[^\s)]+/gi;
      if(findUrlsToggle.checked){cands=(text.match(urlRe)||[]);}else{cands=text.split(/\r?\n/);} 
      const lines=skipBlank.checked?cands.filter(s=>s.trim().length):cands;
      const uniq=dedupe.checked?[...new Set(lines)]:lines;
      results=uniq.map(parseUrl).map((r,i)=>({...r,idx:i+1}));
      render();
    }

    function render(){
      tableBody.innerHTML='';
      results.forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${r.idx}</td><td><a href="${r.original}" target="_blank">${r.original}</a></td><td>${r.username||''}</td><td>${r.tweet_id||''}</td><td>${r.valid?'ok':'invalid'}</td>`;
        tableBody.appendChild(tr);
      });
    }

    function copyToClipboard(text){navigator.clipboard.writeText(text).then(()=>alert('Đã copy')).catch(()=>alert('Copy lỗi'))}

    btnCopyUrls.onclick=()=>copyToClipboard(results.map(r=>r.original).join('\n'));
    btnCopyUsernames.onclick=()=>copyToClipboard(results.map(r=>r.username).filter(Boolean).join('\n'));
    btnCopyIds.onclick=()=>copyToClipboard(results.map(r=>r.tweet_id).filter(Boolean).join('\n'));

    btnDownloadTxt.onclick=()=>{
      const txt=results.map(r=>`${r.original}\n${r.username}\n${r.tweet_id}`).join('\n');
      const blob=new Blob([txt],{type:'text/plain'});
      const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='data.txt';a.click();
    }

    btnExtract.onclick=()=>extract(input.value);
  </script>
</body>
</html>
